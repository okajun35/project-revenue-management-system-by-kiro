# 要件文書

## 概要

プロジェクトの収支管理を効率化するためのシステムです。プロジェクトの売上、経費、粗利を管理し、検索・入力・更新機能とCSV/Excel形式での帳票出力機能を提供します。

## 要件

### 要件 1

**ユーザーストーリー:** プロジェクトマネージャーとして、新しいプロジェクトの収支情報を入力したいので、システムに必要な項目を登録できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーが新規プロジェクト作成を選択 THEN システムは入力フォームを表示する
2. WHEN ユーザーがプロジェクトコードを入力 THEN システムは重複チェックを実行する
3. WHEN ユーザーがプロジェクト名を入力 THEN システムは必須項目として検証する
4. WHEN ユーザーが売上の年度を選択 THEN システムは有効な年度範囲で検証する
5. WHEN ユーザーが受注角度を入力 THEN システムは0-100%の範囲で検証する
6. WHEN ユーザーが売上（契約金）を入力 THEN システムは正の数値として検証する
7. WHEN ユーザーが経費（トータル）を入力 THEN システムは正の数値として検証する
8. WHEN ユーザーが保存ボタンをクリック THEN システムは作成日と更新日を自動設定する
9. WHEN 保存が完了 THEN システムは粗利を自動計算する（売上 - 経費）

### 要件 2

**ユーザーストーリー:** プロジェクトマネージャーとして、既存のプロジェクト収支情報を更新したいので、編集機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがプロジェクトを選択して編集 THEN システムは現在の情報を入力フォームに表示する
2. WHEN ユーザーが項目を変更 THEN システムは変更内容を検証する
3. WHEN ユーザーが更新を保存 THEN システムは更新日を現在日時に設定する
4. WHEN 売上または経費が変更された THEN システムは粗利を再計算する
5. IF プロジェクトコードが変更された THEN システムは重複チェックを実行する

### 要件 3

**ユーザーストーリー:** プロジェクトマネージャーとして、特定の条件でプロジェクトを検索したいので、検索機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーが検索画面にアクセス THEN システムは検索フォームを表示する
2. WHEN ユーザーがプロジェクトコードで検索 THEN システムは部分一致で結果を表示する
3. WHEN ユーザーがプロジェクト名で検索 THEN システムは部分一致で結果を表示する
4. WHEN ユーザーが売上の年度で検索 THEN システムは該当年度のプロジェクトを表示する
5. WHEN ユーザーが受注角度の範囲で検索 THEN システムは指定範囲内のプロジェクトを表示する
6. WHEN ユーザーが複数条件で検索 THEN システムはAND条件で結果を絞り込む
7. WHEN 検索結果が表示される THEN システムは粗利も含めて表示する

### 要件 4

**ユーザーストーリー:** プロジェクトマネージャーとして、既存のCSV/Excelファイルからデータを移行したいので、インポート機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがインポート機能を選択 THEN システムはファイルアップロード画面を表示する
2. WHEN ユーザーがCSVファイルをアップロード THEN システムはファイル形式を検証する
3. WHEN ユーザーがExcelファイルをアップロード THEN システムはファイル形式を検証する
4. WHEN ファイルがアップロードされる THEN システムは列マッピング画面を表示する
5. WHEN ユーザーが列マッピングを設定 THEN システムはプレビュー画面を表示する
6. WHEN プレビューでデータを確認 THEN システムは重複チェックと検証を実行する
7. WHEN ユーザーがインポートを実行 THEN システムは有効なデータのみを取り込む
8. WHEN インポートが完了 THEN システムは取り込み結果（成功件数、エラー件数）を表示する
9. IF データにエラーがある THEN システムはエラー詳細をダウンロード可能な形式で提供する

### 要件 5

**ユーザーストーリー:** プロジェクトマネージャーとして、プロジェクト収支データを帳票として出力したいので、CSV/Excel形式でエクスポートできるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがエクスポート機能を選択 THEN システムは出力形式選択画面を表示する
2. WHEN ユーザーがCSV形式を選択 THEN システムは全項目を含むCSVファイルを生成する
3. WHEN ユーザーがExcel形式を選択 THEN システムは全項目を含むExcelファイルを生成する
4. WHEN エクスポートファイルが生成される THEN システムは以下の項目を含める：プロジェクトコード、プロジェクト名、売上の年度、受注角度、売上（契約金）、経費（トータル）、粗利、作成日、更新日
5. WHEN ユーザーが検索結果をエクスポート THEN システムは検索条件に一致するデータのみを出力する
6. WHEN エクスポートが完了 THEN システムはダウンロードリンクを提供する

### 要件 6

**ユーザーストーリー:** プロジェクトマネージャーとして、プロジェクトの一覧を効率的に確認したいので、ダッシュボード機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがシステムにログイン THEN システムはダッシュボードを表示する
2. WHEN ダッシュボードが表示される THEN システムは総プロジェクト数を表示する
3. WHEN ダッシュボードが表示される THEN システムは総売上額を表示する
4. WHEN ダッシュボードが表示される THEN システムは総経費額を表示する
5. WHEN ダッシュボードが表示される THEN システムは総粗利額を表示する
6. WHEN ダッシュボードが表示される THEN システムは年度別の売上推移を表示する
7. WHEN ダッシュボードが表示される THEN システムは最近更新されたプロジェクト一覧を表示する

### 要件 7

**ユーザーストーリー:** プロジェクトマネージャーとして、不要になったプロジェクトを削除したいので、削除機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがプロジェクトの削除を選択 THEN システムは確認ダイアログを表示する
2. WHEN ユーザーが削除を確認 THEN システムはプロジェクトをデータベースから削除する
3. WHEN 削除が完了 THEN システムは成功メッセージを表示する
4. WHEN 削除されたプロジェクト THEN システムは検索結果や一覧から除外する
5. IF 削除処理でエラーが発生 THEN システムは適切なエラーメッセージを表示する

### 要件 8

**ユーザーストーリー:** プロジェクトマネージャーとして、データを効率的に閲覧したいので、ページネーション機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN プロジェクト一覧に20件以上のデータがある THEN システムはページネーションを表示する
2. WHEN ユーザーがページ番号をクリック THEN システムは該当ページのデータを表示する
3. WHEN ユーザーが次ページボタンをクリック THEN システムは次のページを表示する
4. WHEN ユーザーが前ページボタンをクリック THEN システムは前のページを表示する
5. WHEN 検索結果が複数ページにわたる THEN システムは検索条件を保持してページネーションする

### 要件 9

**ユーザーストーリー:** プロジェクトマネージャーとして、データを見やすく整理したいので、ソート機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーが一覧画面を表示 THEN システムは各列にソート機能を提供する
2. WHEN ユーザーが列ヘッダーをクリック THEN システムはその列で昇順ソートする
3. WHEN ユーザーが同じ列ヘッダーを再度クリック THEN システムは降順ソートする
4. WHEN 数値項目でソート THEN システムは数値として正しくソートする
5. WHEN 日付項目でソート THEN システムは日付として正しくソートする
6. WHEN ソートが適用される THEN システムは現在のソート状態を視覚的に表示する

### 要件 10

**ユーザーストーリー:** プロジェクトマネージャーとして、データの整合性を保ちたいので、システムが適切な検証とエラーハンドリングを行うようにしたい

#### 受け入れ基準

1. WHEN 必須項目が未入力 THEN システムは明確なエラーメッセージを表示する
2. WHEN 数値項目に無効な値が入力された THEN システムは適切な検証エラーを表示する
3. WHEN プロジェクトコードが重複 THEN システムは重複エラーメッセージを表示する
4. WHEN システムエラーが発生 THEN システムはユーザーフレンドリーなエラーメッセージを表示する
5. WHEN データベース接続エラーが発生 THEN システムは適切なエラーハンドリングを実行する

### 要件 11

**ユーザーストーリー:** プロジェクトマネージャーとして、データを安全に管理したいので、バックアップとリストア機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがバックアップ機能を選択 THEN システムは全データをバックアップファイルとして出力する
2. WHEN バックアップが完了 THEN システムはダウンロード可能なファイルを生成する
3. WHEN ユーザーがリストア機能を選択 THEN システムはバックアップファイルのアップロード画面を表示する
4. WHEN バックアップファイルがアップロードされる THEN システムはファイル形式を検証する
5. WHEN リストアが実行される THEN システムは既存データを置き換える前に確認を求める

### 要件 12

**ユーザーストーリー:** システム管理者として、支社情報を管理したいので、支社マスター管理機能を使用できるようにしたい

#### 受け入れ基準

1. WHEN ユーザーが支社管理画面にアクセス THEN システムは支社一覧を表示する
2. WHEN ユーザーが新規支社作成を選択 THEN システムは支社入力フォームを表示する
3. WHEN ユーザーが支社名を入力 THEN システムは重複チェックを実行する
4. WHEN ユーザーが支社コードを入力 THEN システムは重複チェックを実行する
5. WHEN ユーザーが支社を保存 THEN システムは作成日と更新日を自動設定する
6. WHEN ユーザーが既存支社を編集 THEN システムは現在の情報を入力フォームに表示する
7. WHEN ユーザーが支社を更新 THEN システムは更新日を現在日時に設定する
8. WHEN ユーザーが支社を削除しようとする THEN システムは関連プロジェクトの存在をチェックする
9. IF 支社に関連プロジェクトがある THEN システムは削除を拒否してエラーメッセージを表示する
10. WHEN ユーザーが支社の有効/無効を切り替え THEN システムは状態を更新する

### 要件 13

**ユーザーストーリー:** プロジェクトマネージャーとして、プロジェクトを支社別に管理したいので、プロジェクトと支社を関連付けできるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがプロジェクト作成画面にアクセス THEN システムは有効な支社のリストを表示する
2. WHEN ユーザーがプロジェクト編集画面にアクセス THEN システムは現在選択されている支社を表示する
3. WHEN ユーザーが支社を選択 THEN システムは選択された支社をプロジェクトに関連付ける
4. WHEN プロジェクト一覧が表示される THEN システムは各プロジェクトの支社名を表示する
5. WHEN ユーザーが支社で検索 THEN システムは該当支社のプロジェクトのみを表示する
6. WHEN ユーザーが検索画面で支社絞り込みを選択 THEN システムは支社選択ウィンドウを表示する
7. WHEN 支社選択ウィンドウが表示される THEN システムは支社名での部分一致検索を提供する
8. WHEN ユーザーが複数条件で検索（支社含む） THEN システムはAND条件で結果を絞り込む
9. WHEN プロジェクトの詳細画面が表示される THEN システムは関連付けられた支社情報を表示する