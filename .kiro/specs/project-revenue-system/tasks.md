# 実装計画

- [x] 1. プロジェクト基盤とデータベース設定






  - Flaskアプリケーションの基本構造を作成し、SQLAlchemyでプロジェクトデータモデルを実装する
  - requirements.txt、app.py、config.py、データベース初期化スクリプトを作成
  - プロジェクトテーブルの作成とマイグレーション機能を実装
  - _要件: 1.1, 1.8, 2.4_

- [x] 2. AdminLTE基本レイアウトとテンプレート構造









  - AdminLTE 3.2をダウンロードして静的ファイルを配置し、Jinjaテンプレートの基本構造を作成する
  - base.html、ナビゲーション、サイドバーを実装
  - 基本的なルーティングとテンプレート継承を設定
  - _要件: 6.1_

- [x] 3. プロジェクトデータモデルとバリデーション













  - SQLAlchemyでProjectモデルを実装し、全ての必要なフィールドと制約を定義する
  - WTFormsでフォームバリデーションクラスを作成
  - データ検証ロジックとエラーハンドリングを実装
  - _要件: 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 10.1, 10.2, 10.3_
-

- [x] 4. プロジェクト作成機能の実装




  - 新規プロジェクト作成フォームのHTMLテンプレートを作成する
  - プロジェクト作成のルートとコントローラーロジックを実装
  - フォーム送信、バリデーション、データベース保存機能を実装
  - 粗利の自動計算機能を実装
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9_

- [x] 5. プロジェクト一覧表示機能






  - プロジェクト一覧画面のHTMLテンプレートをDataTablesで実装する
  - プロジェクト一覧取得のルートとコントローラーを実装
  - ページネーション、ソート機能を実装
  - 粗利を含む全項目の表示機能を実装
  - _要件: 3.7, 8.1, 8.2, 8.3, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [x] 6. 支社データモデルとマスター管理基盤










  - 支社データモデル（Branch）をSQLAlchemyで実装する
  - 支社テーブルの作成とマイグレーション機能を実装
  - 支社のバリデーション機能を実装（支社コード、支社名の重複チェック）
  - 支社管理用のルートとコントローラーの基本構造を作成
  - _要件: 12.1, 12.2, 12.3, 12.4, 12.5_

- [x] 7. 支社管理画面の実装





  - 支社一覧画面のHTMLテンプレートをDataTablesで実装する
  - 支社作成・編集フォームのHTMLテンプレートを実装
  - 支社の新規作成、編集、削除機能を実装
  - 支社の有効/無効切り替え機能を実装
  - 関連プロジェクト存在チェック機能を実装
  - _要件: 12.1, 12.2, 12.6, 12.7, 12.8, 12.9, 12.10_

- [x] 8. プロジェクトモデルへの支社関連付け

















  - Projectモデルに支社外部キー（branch_id）を追加する
  - プロジェクトと支社のリレーションシップを実装
  - 既存プロジェクトデータのマイグレーション機能を実装
  - プロジェクトのバリデーションに支社チェックを追加
  - _要件: 13.1, 13.2_

- [x] 9. プロジェクト作成・編集での支社選択機能





  - プロジェクト作成・編集フォームに支社選択機能を追加する
  - 有効な支社のリスト表示機能を実装
  - 支社選択のバリデーション機能を実装
  - 現在選択されている支社の表示機能を実装
  - _要件: 13.1, 13.2, 13.3_

- [x] 10. プロジェクト一覧での支社表示機能











  - プロジェクト一覧画面に支社名列を追加する
  - DataTablesでの支社名表示とソート機能を実装
  - プロジェクト詳細画面での支社情報表示を実装
  - _要件: 13.4, 13.9_

- [x] 11. 支社による検索・絞り込み機能










  - 検索画面に支社絞り込み機能を追加する
  - 支社選択ウィンドウ（モーダル）を実装
  - 支社名での部分一致検索機能を実装
  - 支社を含む複数条件でのAND検索機能を実装
  - _要件: 13.5, 13.6, 13.7, 13.8_

- [x] 12. プロジェクト編集・更新機能






  - プロジェクト編集フォームのHTMLテンプレートを作成する
  - 既存プロジェクトデータの取得と表示機能を実装
  - プロジェクト更新のルートとコントローラーロジックを実装
  - 更新日の自動設定と粗利の再計算機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 13. プロジェクト削除機能





  - プロジェクト削除の確認ダイアログをJavaScriptで実装する
  - プロジェクト削除のルートとコントローラーを実装
  - 削除処理とエラーハンドリングを実装
  - 削除後のリダイレクトと成功メッセージ表示を実装
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 14. 検索・フィルター機能の実装





  - 検索フォームのHTMLテンプレートを作成する
  - プロジェクトコード、プロジェクト名での部分一致検索を実装
  - 売上年度、受注角度範囲での検索機能を実装
  - 複数条件でのAND検索機能を実装
  - 検索結果の表示機能を実装
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [x] 15. ダッシュボード統計機能の実装





  - ダッシュボード画面のHTMLテンプレートをAdminLTEで作成する
  - 統計情報計算のサービスクラスを実装（総プロジェクト数、総売上、総経費、総粗利）
  - Chart.jsを使用した年度別売上推移グラフを実装
  - 最近更新されたプロジェクト一覧表示を実装
  - 支社別統計情報の表示機能を追加
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7_

- [x] 16. CSVエクスポート機能の実装











  - CSVエクスポートのルートとコントローラーを実装する
  - pandasを使用してプロジェクトデータをCSV形式で出力
  - 全項目（プロジェクトコード、名前、支社名、年度、受注角度、売上、経費、粗利、作成日、更新日）を含むCSV生成
  - 検索条件に一致するデータのみのエクスポート機能を実装
  - ダウンロードリンクの提供機能を実装
  - _要件: 5.1, 5.2, 5.4, 5.5, 5.6_

- [x] 17. Excelエクスポート機能の実装





  - Excelエクスポートのルートとコントローラーを実装する
  - openpyxlを使用してプロジェクトデータをExcel形式で出力
  - 全項目（支社名含む）を含むExcelファイル生成機能を実装
  - 検索条件に一致するデータのみのエクスポート機能を実装
  - ダウンロードリンクの提供機能を実装
  - _要件: 5.1, 5.3, 5.4, 5.5, 5.6_

- [x] 18. CSVインポート機能の基本実装







  - CSVファイルアップロード画面のHTMLテンプレートを作成する
  - ファイルアップロードのルートとコントローラーを実装
  - pandasを使用したCSVファイルの読み込みと検証機能を実装
  - ファイル形式の検証とエラーハンドリングを実装
  - 支社情報を含むインポート機能を実装
  - _要件: 4.1, 4.2, 4.4_

- [x] 19. インポート列マッピング機能






  - 列マッピング画面のHTMLテンプレートを作成する
  - アップロードされたCSVの列構造を解析し、システムフィールドとのマッピング機能を実装
  - ユーザーが列の対応関係を設定できるインターフェースを実装
  - マッピング設定の保存と検証機能を実装
  - 支社マッピング機能を追加
  - _要件: 4.4, 4.5_

- [x] 20. インポートプレビューと実行機能





  - インポートプレビュー画面のHTMLテンプレートを作成する
  - マッピングされたデータのプレビュー表示機能を実装
  - 重複チェックとデータ検証機能を実装
  - インポート実行機能と結果表示（成功件数、エラー件数）を実装
  - エラー詳細のダウンロード機能を実装
  - _要件: 4.5, 4.6, 4.7, 4.8, 4.9_

- [x] 21. Excelインポート機能の実装






  - Excelファイルアップロード機能を実装する
  - openpyxlを使用したExcelファイルの読み込み機能を実装
  - Excel形式の検証とエラーハンドリングを実装
  - CSVインポートと同様の列マッピング、プレビュー、実行機能を実装
  - _要件: 4.1, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9_

- [x] 22. バックアップ・リストア機能の実装





  - バックアップ機能のルートとコントローラーを実装する
  - 全データ（プロジェクト・支社）をJSON形式でバックアップファイルとして出力
  - リストア機能のファイルアップロード画面を実装
  - バックアップファイルの検証とリストア実行機能を実装
  - リストア前の確認ダイアログを実装
  - _要件: 11.1, 11.2, 11.3, 11.4, 11.5_

- [ ] 23. サービス層の実装とリファクタリング
  - ProjectService、BranchService、FileService、DashboardService、ValidationServiceクラスを作成する
  - コントローラーからビジネスロジックをサービス層に移動
  - 各サービスクラスのメソッドを実装し、コードの再利用性を向上
  - 依存性注入パターンを適用してテストしやすい構造に変更
  - _要件: 全要件のビジネスロジック部分_

- [ ] 24. 単体テストの実装
  - pytestとpytest-flaskを使用したテスト環境を設定する
  - ProjectモデルとBranchモデルの単体テストを作成
  - 各サービスクラスの単体テストを作成
  - バリデーション機能のテストを作成
  - テストデータ（fixtures）を作成
  - _要件: 全要件のテスト_

- [ ] 25. 統合テストの実装
  - Flask アプリケーションの統合テストを作成する
  - 各ルートのHTTPリクエスト・レスポンステストを実装
  - フォーム送信とデータベース操作のテストを実装
  - ファイルアップロード・ダウンロード機能のテストを実装
  - エラーハンドリングのテストを実装
  - _要件: 全要件の統合テスト_

- [x] 26. Docker化とデプロイ設定





  - Dockerfileを作成してFlaskアプリケーションをコンテナ化する
  - docker-compose.ymlでNginx + Flaskの構成を実装
  - Nginx設定ファイルを作成してリバースプロキシを設定
  - 本番環境用の環境変数設定を実装
  - ヘルスチェック機能を実装
  - _要件: デプロイメント要件_

- [ ] 27. CI/CDパイプラインの実装
  - GitHub Actionsワークフローファイルを作成する
  - 自動テスト実行の設定を実装
  - コードカバレッジ測定と報告機能を実装
  - Dockerイメージの自動ビルドとテストを実装
  - デプロイメント自動化の設定を実装
  - _要件: CI/CD要件_